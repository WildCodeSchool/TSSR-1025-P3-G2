# 1. Cr√©ation du dossier 'psk' s'il n'existe pas
New-Item -ItemType Directory -Force -Path ".\psk" | Out-Null

# 2. Liste des machines pour lesquelles tu veux une cl√©
$machines = @("ECO-BDX-AX01", "ECO-BDX-DX03")

foreach ($machine in $machines) {
    # G√©n√©ration s√©curis√©e de 32 octets al√©atoires
    $bytes = New-Object byte[] 32
    [System.Security.Cryptography.RandomNumberGenerator]::Create().GetBytes($bytes)

    # Conversion en Hexad√©cimal pur (suppression des tirets)
    # C'est cette √©tape qui garantit que Zabbix acceptera la cl√© (0-9, A-F uniquement)
    $psk = [BitConverter]::ToString($bytes).Replace("-","")

    # Sauvegarde dans le fichier sp√©cifique
    $cheminFichier = ".\psk\$machine.psk"
    $psk | Out-File $cheminFichier -Encoding ascii -NoNewline -Force

    # Affichage pour copier-coller dans Zabbix
    Write-Host "‚úÖ Fichier g√©n√©r√© : $cheminFichier" -ForegroundColor Cyan
    Write-Host "üîë Cl√© PSK        : $psk" -ForegroundColor Green
    Write-Host "-----------------------------------------------------------"
}
